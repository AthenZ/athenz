
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Athenz User Guide">
      
      
      
      
      <link rel="icon" href="../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-7.3.6">
    
    
      
        <title>Azure Identity Access Tokens - Athenz</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a57b2b03.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../../extra.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#azure-identity-access-tokens" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Athenz" class="md-header__button md-logo" aria-label="Athenz" data-md-component="logo">
      
  <img src="../../images/athenz-icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Athenz
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Azure Identity Access Tokens
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/AthenZ/athenz" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Athenz" class="md-nav__button md-logo" aria-label="Athenz" data-md-component="logo">
      
  <img src="../../images/athenz-icon.png" alt="logo">

    </a>
    Athenz
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/AthenZ/athenz" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        About
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dev_environment/" class="md-nav__link">
        Development Environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_3" type="checkbox" id="__nav_1_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_3">
          Local/Development/Production Environment Setup
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Local/Development/Production Environment Setup" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_3">
          <span class="md-nav__icon md-icon"></span>
          Local/Development/Production Environment Setup
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../setup_zms/" class="md-nav__link">
        ZMS Server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../setup_zts/" class="md-nav__link">
        ZTS Server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../setup_ui/" class="md-nav__link">
        UI Server
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_4" type="checkbox" id="__nav_1_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_4">
          Service Identity Registration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Service Identity Registration" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_4">
          <span class="md-nav__icon md-icon"></span>
          Service Identity Registration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../service_x509_credentials/" class="md-nav__link">
        Using X.509 Certificates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reg_service_guide/" class="md-nav__link">
        Using Public/Private Key Pairs
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Management
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Management" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Management
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../role_delegation/" class="md-nav__link">
        Role Delegation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../token_expiration/" class="md-nav__link">
        Access token Limit Expiry Support
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../role_cert_expiration/" class="md-nav__link">
        Role Certificate Limit Expiry Support
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../review_enabled_roles/" class="md-nav__link">
        Review Enabled Roles
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../email_notifications/" class="md-nav__link">
        Email Notifications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../events_monitoring/" class="md-nav__link">
        Events Monitoring
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../member_expiration/" class="md-nav__link">
        Role Member Auto Expiry and Notification Support
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../member_soft_expiration/" class="md-nav__link">
        Role Member Review Reminder Support
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../self_serve_roles/" class="md-nav__link">
        Self-Served Roles
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../athenz_templates/" class="md-nav__link">
        Athenz Templates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../principal_groups/" class="md-nav__link">
        Principal Groups
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Authentication
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Authentication" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Authentication
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../service_authentication/" class="md-nav__link">
        Athenz Service Identity X.509 Certificate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../service_x509_credentials_aws/" class="md-nav__link">
        Athenz Service Identity X.509 Certificate for AWS EC2 instances
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../service_x509_credentials_aws_ecs/" class="md-nav__link">
        Athenz Service Identity X.509 Certificate for AWS ECS containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../service_x509_credentials_aws_fargate/" class="md-nav__link">
        Athenz Service Identity X.509 Certificate for AWS Fargate tasks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../service_x509_credentials_aws_eks/" class="md-nav__link">
        Athenz Service Identity X.509 Certificate for AWS EKS pods
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../service_x509_credentials_aws_lambda/" class="md-nav__link">
        Athenz Service Identity X.509 Certificate for AWS Lambda functions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../zts_access_token_guide/" class="md-nav__link">
        Obtaining OAuth2 Access Tokens from ZTS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../oidc_aws_eks/" class="md-nav__link">
        Athenz OIDC Authentication Provider Support for AWS EKS
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          AWS Setup
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="AWS Setup" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          AWS Setup
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../aws_temp_creds/" class="md-nav__link">
        AWS Temp Credentials
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../aws_athenz_setup/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Architecture
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Architecture" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Architecture
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../data_model/" class="md-nav__link">
        Data Model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../system_view/" class="md-nav__link">
        System View
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../auth_flow/" class="md-nav__link">
        Authorization Flow
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Features
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Features" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Features
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../copper_argos/" class="md-nav__link">
        Service Identity X.509 Certificates - Copper Argos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../capabilities/" class="md-nav__link">
        Athenz Capabilities
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Developer Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Developer Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Developer Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cent_authz_flow/" class="md-nav__link">
        Centralized Authorization Flow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../decent_authz_flow/" class="md-nav__link">
        Decentralized Authorization Flow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../client_side_x509_credentials/" class="md-nav__link">
        Client Side Service Identity Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../server_side_x509_credentials/" class="md-nav__link">
        Server Side Service Identity Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../example_java_centralized_access/" class="md-nav__link">
        Java Client/Servlet Centralized Example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../example_go_centralized_access/" class="md-nav__link">
        Go Client/Server Example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../example_java_decentralized_access/" class="md-nav__link">
        Java Client/Servlet Decentralized Example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../local_ui_development/" class="md-nav__link">
        Local UI development
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_9" type="checkbox" id="__nav_7_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_9">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_9">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api/index.html?server=zms" class="md-nav__link">
        ZMS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api/index.html?server=zts" class="md-nav__link">
        ZTS
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Customizing Athenz
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Customizing Athenz" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Customizing Athenz
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../principal_authentication/" class="md-nav__link">
        Principal Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../private_key_store/" class="md-nav__link">
        Private Key Store
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cert_signer/" class="md-nav__link">
        Certificate Signer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../copper_argos_dev/" class="md-nav__link">
        Service Identity X.509 Certificate Support Requirements - Copper Argos
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          User Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="User Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          User Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../zms_client/" class="md-nav__link">
        ZMS Client Utility
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../setup_zpu/" class="md-nav__link">
        ZPU Utility
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../zts_rolecert/" class="md-nav__link">
        ZTS Role Certificate Client Utility
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../zts_accesstoken/" class="md-nav__link">
        ZTS OAuth2 Access Token Client
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reg_service_guide/" class="md-nav__link">
        Using Public/Private Key Pairs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../local_athenz_on_docker/" class="md-nav__link">
        Using Athenz on local docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how_to_sample_identity_from_local_athenz/" class="md-nav__link">
        Quick Guide to obtain identity cert using local docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how_to_sample_identity_from_local_athenz_ec2/" class="md-nav__link">
        Quick Guide to obtain identity cert using local docker on EC2
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_10">
          References
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="References" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          References
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../zms_api/" class="md-nav__link">
        ZMS REST API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../zts_api/" class="md-nav__link">
        ZTS REST API
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#design" class="md-nav__link">
    Design
  </a>
  
    <nav class="md-nav" aria-label="Design">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#required-setup" class="md-nav__link">
    Required setup
  </a>
  
    <nav class="md-nav" aria-label="Required setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#athenz" class="md-nav__link">
    Athenz
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#azure" class="md-nav__link">
    Azure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rdl-struct-updates" class="md-nav__link">
    RDL Struct Updates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-changes" class="md-nav__link">
    API Changes
  </a>
  
    <nav class="md-nav" aria-label="API Changes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-domain-for-azure" class="md-nav__link">
    Configuring domain for Azure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#obtaining-azure-access-tokens" class="md-nav__link">
    Obtaining Azure access tokens
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/AthenZ/athenz/edit/master/docs/design/azure_identity_access_tokens.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="azure-identity-access-tokens">Azure Identity Access Tokens<a class="headerlink" href="#azure-identity-access-tokens" title="Permanent link">&para;</a></h1>
<p>Integration with Azure's user managed identities serves two purposes in Athenz:</p>
<ol>
<li>Athenz users can obtain access tokens for Azure APIs, for their Azure identities,
   through ZTS and by being part of designated Athenz roles.</li>
<li>ZTS can access Azure APIs to run an instance provider component internally,
   supporting any number of tenants with an Azure subscription in an easy manner.</li>
</ol>
<h2 id="design">Design<a class="headerlink" href="#design" title="Permanent link">&para;</a></h2>
<p>Azure allows its users to exchange ID tokens signed by a designated issuer for access tokens
for a configured user managed identity: 
<a href="https://learn.microsoft.com/en-us/entra/identity-platform/v2-oauth2-client-creds-grant-flow#third-case-access-token-request-with-a-federated-credential">Azure reference documentation</a>.
This API for federated identities is a bit limited; only the <code>iss</code>, <code>sub</code> and <code>aud</code> claims are relevant:</p>
<ol>
<li>The designated issuer must match the <code>iss</code> claim.</li>
<li>The <code>aud</code> is encouraged to be <code>api://AzureADTokenExchange</code>.</li>
<li>This means the issuer must use the <code>sub</code> claim to differentiate between exchange ID tokens for different Azure identities. </li>
</ol>
<p>As the main goal here is to allow Athenz users to translate their Athenz credentials into Azure access tokens,
and we want to use Athenz role membership to control who has access to what federated Azure identities, we propose
the following configuration of the federated identity credentials in Azure:</p>
<ol>
<li>ZTS issues ID tokens with its configured OAuth issuer in the <code>iss</code> claim.</li>
<li>Each Azure identity is linked to a single Athenz role; this link is established by using the full role ARN, e.g.,
   <code>coretech:role.azure-client</code>, as the expected <code>sub</code> of the exchange tokens.</li>
<li>ZTS uses the suggested <code>api://AzureADTokenExchange</code> for the <code>aud</code> claim.</li>
</ol>
<p>We also want the Athenz users to be able to obtain credentials for an Azure identity by its <em>name</em> and enclosing <em>resource group</em>,
rather than the UUID-type <em>client ID</em> of the credential. This requires ZTS to have read access to the user managed identities of
the user's Azure subscription, which we solve by configuring a dedicated "Athenz Azure client" identity in the Azure subscription,
with the required read privileges. Giving this identity read privileges to VM instance metadata also allows ZTS to run the Azure
instance provider (below), which is easier than setting up a webserver which runs the provider code within each Azure subscription.</p>
<h3 id="required-setup">Required setup<a class="headerlink" href="#required-setup" title="Permanent link">&para;</a></h3>
<p>To enable the Azure integration, there is some configuration on the Athenz side for the Athenz system administrators.
Users must do some setup in both Athenz and Azure for onboarding, and also for each new Azure identity to assume.</p>
<h4 id="athenz">Athenz<a class="headerlink" href="#athenz" title="Permanent link">&para;</a></h4>
<p>Globally, for the whole Athenz system:</p>
<ol>
<li>Create a system role <code>athenz.azure:role.azure-client</code>. This represents ZTS, and will allow access to Azure APIs needed to
   verify VM instance identity requests and look up Azure identities.<ol>
<li>Ensure all instance providers are members of this role, so they can read VM data.</li>
<li>The Azure Access Token Provider obtains ID tokens for this role without memership checks.</li>
</ol>
</li>
<li>Required configuration for the ZTS server (which also runs the instance providers):<ol>
<li><code>athenz.zts.external_creds_providers=gcp,azure</code> (Azure is not enabled by default.)</li>
<li><code>athenz.zts.oauth_issuer=&lt;ZTS API URL&gt;</code></li>
<li><code>athenz.zts.azure_resource_uri=api://&lt;ZTS HOSTNAME&gt;</code></li>
<li><code>athenz.zts.azure_dns_suffix=...</code> (System-specific.)</li>
</ol>
</li>
</ol>
<p>For each domain that uses Azure as a cloud provider:</p>
<ol>
<li>Specify Azure <em>subscription</em>, <em>tenant</em> and <em>client</em> on the domain; these are system meta attributes, see the below RDL changes for details.</li>
<li>For each user managed Azure identity to assume, create a designated role under the domain. Members of this role will be
   able to acquire an access token for the linked Azure identity from ZTS, for configured scope(s):<ol>
<li>Create a policy <code>ALLOW azure.scope_access to &lt;identity&gt; on &lt;scope&gt;</code>, e.g. allow the linked role default scope access:<br />
<code>ALLOW azure.scope_access to azure-log-reader on https://management.azure.com/.default</code>.</li>
<li>Not implemented, but a suggestion for later:<br />
   Create a policy <code>ALLOW azure.assume_identity to XXX on &lt;resource group&gt;.&lt;client name&gt;</code>
   that can be used by ZMS to list accessible identities for a user, like for AWS and GCP.</li>
</ol>
</li>
</ol>
<h4 id="azure">Azure<a class="headerlink" href="#azure" title="Permanent link">&para;</a></h4>
<p>For each Azure tenant:</p>
<ol>
<li>Create the "Athenz Azure client" user managed identity, which ZTS assumes when reading data (VMs and user managed identities, see above):<ol>
<li>Add a federated credential which allows ZTS to assume the identity with:<ol>
<li>issuer: <code>&lt;ZTS API URL&gt;</code></li>
<li>subject: <code>athenz.azure:role.azure-client</code></li>
<li>audience: <code>api://AzureADTokenExchange</code></li>
</ol>
</li>
<li>Create and assign it a role with permissions:<ol>
<li><code>Microsoft.ManagedIdentity/userAssignedIdentities/read</code></li>
<li><code>Microsoft.Compute/virtualMachines/read</code></li>
</ol>
</li>
<li>Note the ID of the created identity, and register it on the corresponding Athenz domain, together with the tenant and subscription IDs (see above). </li>
</ol>
</li>
<li>Create an app registration to use as the token audience for VM metadata (required configuration for the SIA agent on Azure VMs), with:<ol>
<li>sign-in-audience: <code>AzureADMultipleOrgs</code></li>
<li>identifier-uris: <code>api://&lt;ZTS HOSTNAME&gt;</code></li>
</ol>
</li>
<li>Set up additional user managed identities with custom roles, as required:<ol>
<li>Add a federated credential which allows members of the designated Athenz role to assume the identity:<ol>
<li>issuer: <code>&lt;ZTS API URL&gt;</code></li>
<li>subject: <code>&lt;domain&gt;:role.&lt;role&gt;</code></li>
<li>audience: <code>api://AzureADTokenExchange</code></li>
</ol>
</li>
<li>Note the resource group and name of the identity; these are used when obtaining access tokens through Athenz, see below.</li>
</ol>
</li>
</ol>
<p>Multiple subscriptions within the same tenant can share the same client setup.</p>
<h3 id="rdl-struct-updates">RDL Struct Updates<a class="headerlink" href="#rdl-struct-updates" title="Permanent link">&para;</a></h3>
<p><code>DomainMeta</code> has two new system meta attribute fields <code>azureTenant</code> and <code>azureClient</code>:</p>
<div class="highlight"><pre><span></span><code>type DomainMeta Struct {
    ...

    String azureSubscription (optional); //associated azure subscription id (system attribute - uniqueness check - if enabled)
    String azureTenant (optional); //associated azure tenant id (system attribute)
    String azureClient (optional); //associated azure client id (system attribute)
    ...
}
</code></pre></div>
<h3 id="api-changes">API Changes<a class="headerlink" href="#api-changes" title="Permanent link">&para;</a></h3>
<h4 id="configuring-domain-for-azure">Configuring domain for Azure<a class="headerlink" href="#configuring-domain-for-azure" title="Permanent link">&para;</a></h4>
<p>The new <code>DomainMeta</code> fields are updated like <code>azureSubscription</code>, through <code>PUT "/domain/{name}/meta/system/{attribute}"</code>.
The payload must now contain all three fields (above)—not just the <code>azureSubscription</code>. </p>
<h4 id="obtaining-azure-access-tokens">Obtaining Azure access tokens<a class="headerlink" href="#obtaining-azure-access-tokens" title="Permanent link">&para;</a></h4>
<p>To get an access token for the example user managed identity <code>log-reader</code> in the Azure resource group <code>system</code>, associated with
the Athenz role <code>azure-log-reader</code> under the Athenz domain <code>coretech</code>, simply do:</p>
<div class="highlight"><pre><span></span><code>POST &lt;ZTS API URL&gt;/external/azure/coretech/creds
{ 
  &quot;clientId&quot;: &quot;coretech.azure&quot;,
  &quot;attributes&quot;: {
    &quot;athenzRole&quot;: &quot;azure-log-reader&quot;,
    &quot;azureResourceGroup&quot;: &quot;system&quot;,
    &quot;azureClientName&quot;: &quot;log-reader&quot;,
    “azureScope&quot;: &lt;optional: defaults to &quot;https://management.azure.com/.default&quot;&gt;
  }
}
</code></pre></div>
<p><strong>Note 1:</strong> The :clientId: should be <code>&lt;domain&gt;.azure</code>, although it is not really used for anything. This was done to match the GCP setup.</p>
<p><strong>Note 2:</strong> It is also possible to specify <code>"azureClientId"</code> instead of <code>"azureResourceGroup"</code> and <code>"azureClientName"</code>. When this is specified,
ZTS skips the client ID lookup, and uses the supplied value instead.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.fcfe8b6d.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.b1047164.min.js"></script>
      
    
  </body>
</html>