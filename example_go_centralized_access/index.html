
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Athenz User Guide">
      
      
      
      <link rel="shortcut icon" href="../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.0.2">
    
    
      
        <title>Go Client/Server Example - Athenz</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.38780c08.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f72e892.min.css">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#go-clientserver-example-centralized-access-control" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Athenz" class="md-header-nav__button md-logo" aria-label="Athenz">
      
  <img src="../images/athenz-icon.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Athenz
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Go Client/Server Example
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/AthenZ/athenz/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Athenz" class="md-nav__button md-logo" aria-label="Athenz">
      
  <img src="../images/athenz-icon.png" alt="logo">

    </a>
    Athenz
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/AthenZ/athenz/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Getting Started
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        <span class="md-nav__icon md-icon"></span>
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      About
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dev_environment/" class="md-nav__link">
      Development Environment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-1-3" type="checkbox" id="nav-1-3">
    
    <label class="md-nav__link" for="nav-1-3">
      Local/Development Environment Setup
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Local/Development Environment Setup" data-md-level="2">
      <label class="md-nav__title" for="nav-1-3">
        <span class="md-nav__icon md-icon"></span>
        Local/Development Environment Setup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../setup_zms/" class="md-nav__link">
      ZMS Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../setup_zts/" class="md-nav__link">
      ZTS Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../setup_ui/" class="md-nav__link">
      UI Server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-1-4" type="checkbox" id="nav-1-4">
    
    <label class="md-nav__link" for="nav-1-4">
      Production Environment Setup
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Production Environment Setup" data-md-level="2">
      <label class="md-nav__title" for="nav-1-4">
        <span class="md-nav__icon md-icon"></span>
        Production Environment Setup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../setup_zms_prod/" class="md-nav__link">
      ZMS Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../setup_zts_prod/" class="md-nav__link">
      ZTS Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../setup_ui_prod/" class="md-nav__link">
      UI Server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-1-5" type="checkbox" id="nav-1-5">
    
    <label class="md-nav__link" for="nav-1-5">
      Service Identity Registration
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Service Identity Registration" data-md-level="2">
      <label class="md-nav__title" for="nav-1-5">
        <span class="md-nav__icon md-icon"></span>
        Service Identity Registration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../service_x509_credentials/" class="md-nav__link">
      Using X.509 Certificates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../reg_service_guide/" class="md-nav__link">
      Using Public/Private Key Pairs
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Management
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Management" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Management
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../role_delegation/" class="md-nav__link">
      Role Delegation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../token_expiration/" class="md-nav__link">
      Access token Limit Expiry Support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../role_cert_expiration/" class="md-nav__link">
      Role Certificate Limit Expiry Support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../review_enabled_roles/" class="md-nav__link">
      Review Enabled Roles
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../email_notifications/" class="md-nav__link">
      Email Notifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../events_monitoring/" class="md-nav__link">
      Events Monitoring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../member_expiration/" class="md-nav__link">
      Role Member Auto Expiry and Notification Support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../member_soft_expiration/" class="md-nav__link">
      Role Member Review Reminder Support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../self_serve_roles/" class="md-nav__link">
      Self-Served Roles
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../athenz_templates/" class="md-nav__link">
      Athenz Templates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../principal_groups/" class="md-nav__link">
      Principal Groups
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Authentication
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Authentication" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Authentication
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../service_x509_credentials_aws/" class="md-nav__link">
      Athenz Service Identity X.509 Certificate for AWS EC2 instances
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../service_x509_credentials_aws_ecs/" class="md-nav__link">
      Athenz Service Identity X.509 Certificate for AWS ECS containers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../service_x509_credentials_aws_fargate/" class="md-nav__link">
      Athenz Service Identity X.509 Certificate for AWS Fargate tasks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../service_x509_credentials_aws_eks/" class="md-nav__link">
      Athenz Service Identity X.509 Certificate for AWS EKS pods
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../service_x509_credentials_aws_lambda/" class="md-nav__link">
      Athenz Service Identity X.509 Certificate for AWS Lambda functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../zts_access_token_guide/" class="md-nav__link">
      Obtaining OAuth2 Access Tokens from ZTS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      AWS Setup
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="AWS Setup" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        AWS Setup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../aws_temp_creds/" class="md-nav__link">
      AWS Temp Credentials
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aws_athenz_setup/" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aws_zms_setup/" class="md-nav__link">
      ZMS Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aws_zts_setup/" class="md-nav__link">
      ZTS Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aws_ui_setup/" class="md-nav__link">
      UI Server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Architecture
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Architecture" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Architecture
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../data_model/" class="md-nav__link">
      Data Model
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../system_view/" class="md-nav__link">
      System View
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../auth_flow/" class="md-nav__link">
      Authorization Flow
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Features
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Features" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon"></span>
        Features
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../copper_argos/" class="md-nav__link">
      Service Identity X.509 Certificates - Copper Argos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../capabilities/" class="md-nav__link">
      Athenz Capabilities
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" checked>
    
    <label class="md-nav__link" for="nav-7">
      Developer Guide
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Developer Guide" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon"></span>
        Developer Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../cent_authz_flow/" class="md-nav__link">
      Centralized Authorization Flow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../decent_authz_flow/" class="md-nav__link">
      Decentralized Authorization Flow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../client_side_x509_credentials/" class="md-nav__link">
      Client Side Service Identity Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../server_side_x509_credentials/" class="md-nav__link">
      Server Side Service Identity Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../example_java_centralized_access/" class="md-nav__link">
      Java Client/Servlet Centralized Example
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Go Client/Server Example
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Go Client/Server Example
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#required-components" class="md-nav__link">
    Required Components
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#service-definition" class="md-nav__link">
    Service Definition
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resource-definition" class="md-nav__link">
    Resource Definition
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#athenz-management-setup" class="md-nav__link">
    Athenz Management Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code-changes" class="md-nav__link">
    Code Changes
  </a>
  
    <nav class="md-nav" aria-label="Code Changes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#client-changes" class="md-nav__link">
    Client Changes
  </a>
  
    <nav class="md-nav" aria-label="Client Changes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#client-import-dependency-update" class="md-nav__link">
    Client Import Dependency Update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#obtaining-ntokens" class="md-nav__link">
    Obtaining NTokens
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-go-zms_svctoken-client-utility" class="md-nav__link">
    Build Go zms_svctoken Client Utility
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server-changes" class="md-nav__link">
    Server Changes
  </a>
  
    <nav class="md-nav" aria-label="Server Changes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#server-import-dependency-update" class="md-nav__link">
    Server Import Dependency Update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authorization-checks" class="md-nav__link">
    Authorization Checks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-server" class="md-nav__link">
    Build Server
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploying-example-server" class="md-nav__link">
    Deploying Example Server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-cases" class="md-nav__link">
    Test Cases
  </a>
  
    <nav class="md-nav" aria-label="Test Cases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#invalid-access-without-servicetoken" class="md-nav__link">
    Invalid Access Without ServiceToken
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#movie-editor-access" class="md-nav__link">
    Movie Editor Access
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tvshow-editor-access" class="md-nav__link">
    TvShow Editor Access
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#site-editor-access" class="md-nav__link">
    Site Editor Access
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-test-cases" class="md-nav__link">
    Other Test Cases
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../example_java_decentralized_access/" class="md-nav__link">
      Java Client/Servlet Decentralized Example
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Customizing Athenz
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Customizing Athenz" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon"></span>
        Customizing Athenz
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../principal_authentication/" class="md-nav__link">
      Principal Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../private_key_store/" class="md-nav__link">
      Private Key Store
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cert_signer/" class="md-nav__link">
      Certificate Signer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../copper_argos_dev/" class="md-nav__link">
      Service Identity X.509 Certificate Support Requirements - Copper Argos
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      User Guide
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="User Guide" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        <span class="md-nav__icon md-icon"></span>
        User Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../zms_client/" class="md-nav__link">
      ZMS Client Utility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../setup_zpu/" class="md-nav__link">
      ZPU Utility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../zts_rolecert/" class="md-nav__link">
      ZTS Role Certificate Client Utility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../zts_accesstoken/" class="md-nav__link">
      ZTS OAuth2 Access Token Client
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../reg_service_guide/" class="md-nav__link">
      Registering ZMS Service Identity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../local_athenz_on_docker/" class="md-nav__link">
      Using Athenz on local docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../how_to_sample_identity_from_local_athenz/" class="md-nav__link">
      Quick Guide to obtain identity cert using local docker
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      References
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="References" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        <span class="md-nav__icon md-icon"></span>
        References
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../zms_api/" class="md-nav__link">
      ZMS REST API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../zts_api/" class="md-nav__link">
      ZTS REST API
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#required-components" class="md-nav__link">
    Required Components
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#service-definition" class="md-nav__link">
    Service Definition
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resource-definition" class="md-nav__link">
    Resource Definition
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#athenz-management-setup" class="md-nav__link">
    Athenz Management Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code-changes" class="md-nav__link">
    Code Changes
  </a>
  
    <nav class="md-nav" aria-label="Code Changes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#client-changes" class="md-nav__link">
    Client Changes
  </a>
  
    <nav class="md-nav" aria-label="Client Changes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#client-import-dependency-update" class="md-nav__link">
    Client Import Dependency Update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#obtaining-ntokens" class="md-nav__link">
    Obtaining NTokens
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-go-zms_svctoken-client-utility" class="md-nav__link">
    Build Go zms_svctoken Client Utility
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server-changes" class="md-nav__link">
    Server Changes
  </a>
  
    <nav class="md-nav" aria-label="Server Changes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#server-import-dependency-update" class="md-nav__link">
    Server Import Dependency Update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authorization-checks" class="md-nav__link">
    Authorization Checks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-server" class="md-nav__link">
    Build Server
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploying-example-server" class="md-nav__link">
    Deploying Example Server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-cases" class="md-nav__link">
    Test Cases
  </a>
  
    <nav class="md-nav" aria-label="Test Cases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#invalid-access-without-servicetoken" class="md-nav__link">
    Invalid Access Without ServiceToken
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#movie-editor-access" class="md-nav__link">
    Movie Editor Access
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tvshow-editor-access" class="md-nav__link">
    TvShow Editor Access
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#site-editor-access" class="md-nav__link">
    Site Editor Access
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-test-cases" class="md-nav__link">
    Other Test Cases
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/AthenZ/athenz/edit/master/docs/example_go_centralized_access.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="go-clientserver-example-centralized-access-control">Go Client/Server Example - Centralized Access Control<a class="headerlink" href="#go-clientserver-example-centralized-access-control" title="Permanent link">&para;</a></h1>
<hr />
<ul>
<li><a href="#required-components">Required Components</a></li>
<li><a href="#service-definition">Service Definition</a></li>
<li><a href="#resource-definition">Resource Definition</a></li>
<li><a href="#athenz-management-setup">Athenz Management Setup</a></li>
<li><a href="#code-changes">Code Changes</a><ul>
<li><a href="#client-changes">Client Changes</a><ul>
<li><a href="#client-import-dependency-update">Client Import Dependency Update</a></li>
<li><a href="#obtaining-ntokens">Obtaining NTokens</a></li>
<li><a href="#build-go-zms_svctoken-client-utility">Build Go zms_svctoken Client Utility</a></li>
</ul>
</li>
<li><a href="#server-changes">Server Changes</a><ul>
<li><a href="#server-project-dependency-update">Server Project Dependency Update</a></li>
<li><a href="#authorization-checks">Authorization Checks</a></li>
<li><a href="#build-server">Build Server</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#deploying-example-servlet">Deploying Example Servlet</a></li>
<li><a href="#test-cases">Test Cases</a><ul>
<li><a href="#invalid-access-without-servicetoken">Invalid Access Without ServiceToken</a></li>
<li><a href="#movie-editor-access">Movie Editor Access</a></li>
<li><a href="#tvshow-editor-access">TvShow Editor Access</a></li>
<li><a href="#site-editor-access">Site Editor Access</a></li>
<li><a href="#other-test-cases">Other Test Cases</a></li>
</ul>
</li>
</ul>
<p>In the centralized access control model, the service as a principal
requests its NToken from SIA Provider and then presents it to the
target service which would perform an identical check with ZMS to confirm
access.</p>
<p><img alt="Authenticated Service as Principal" src="../images/centralized_authz_for_services.png" /></p>
<p>The required steps to setup the environment for provider and tenant
services to support centralized access control are as follows:</p>
<ul>
<li>System administrator creates the provider and tenant domains.</li>
<li>Tenant Domain administrator generates a public/private key pair
  and registers a service in its domain.</li>
<li>Provider Domain administrator creates a role and policy that
  grants access to the given role with configured action and resource.</li>
<li>Provider Domain administrator adds the Tenant Service to the
  role to grant access.</li>
<li>Tenant Domain administrator installs the private key on the host
  that will be running the client/tenant service.</li>
</ul>
<h2 id="required-components">Required Components<a class="headerlink" href="#required-components" title="Permanent link">&para;</a></h2>
<hr />
<p>To support centralized access control in your applications,
you only need to install and configure the Athenz ZMS
server along with the Athenz UI. Please follow these guides
to make sure you have both of those components up and
running in your environment:</p>
<ul>
<li><a href="../setup_zms/">ZMS Server</a></li>
<li><a href="../setup_ui/">UI Server</a></li>
</ul>
<p>To build the client and server components of this example,
you need to download and install Go and Git client
if you don't already have these available on your box:</p>
<ul>
<li><a href="https://golang.org/doc/install">The Go Programming Language</a></li>
<li><a href="https://git-scm.com/downloads">Git client</a></li>
</ul>
<p>Make sure your GOPATH variable is set and the PATH variable
includes the $(GOPATH)/bin to run the utilities.</p>
<h2 id="service-definition">Service Definition<a class="headerlink" href="#service-definition" title="Permanent link">&para;</a></h2>
<hr />
<p>Let's first define our service that needs to be Athenz protected.
We have a simple recommendation service that returns either a movie
or tv show for the caller. It has two endpoints:</p>
<div class="codehilite"><pre><span></span><code><span class="err">GET /rec/v1/movie</span>
<span class="err">GET /rec/v1/tvshow</span>
</code></pre></div>

<p>So in this first release we just want to protect access to these
endpoints. The traffic is very low - we only expect a couple of
requests an hour so we have decided to use Athenz' centralized
authorization model.</p>
<h2 id="resource-definition">Resource Definition<a class="headerlink" href="#resource-definition" title="Permanent link">&para;</a></h2>
<hr />
<p>Defining resources and actions the principals are authorized
to execute is one of the most important tasks
in the authorization process. Based on our endpoints, it's expected
that we'll have 2 general resources:</p>
<div class="codehilite"><pre><span></span><code><span class="err">movie</span>
<span class="err">tvshow</span>
</code></pre></div>

<p>The resources are referenced in their own domain namespace. So those
are valid if your domain is specifically created to support this
recommendation service only. But's lets assume we might add rental
support later, so we need to make sure the policies are based on
service specific resources. So we'll define our resources as:</p>
<div class="codehilite"><pre><span></span><code><span class="err">rec.movie</span>
<span class="err">rec.tvshow</span>
</code></pre></div>

<p>Support action for these resources would be <code>read</code>. We can extend
our authorization policies later on if we need to introduce other
actions - such as <code>write</code> or <code>list</code> as we add more functionality into
our service.</p>
<h2 id="athenz-management-setup">Athenz Management Setup<a class="headerlink" href="#athenz-management-setup" title="Permanent link">&para;</a></h2>
<hr />
<p>Once we have defined what our resources and actions are, we can
create their respective client and server (also commonly referred
as tenant and provider) roles and policies in Athenz. Go to
Athenz UI and login with your account which should have system
administrator access. Follow the instructions in the following
guide to setup the required access control:</p>
<ul>
<li><a href="../example_service_athenz_setup/">Access Control Setup</a></li>
</ul>
<h2 id="code-changes">Code Changes<a class="headerlink" href="#code-changes" title="Permanent link">&para;</a></h2>
<hr />
<p>Both the client and server implementors need to make changes
in their respective code bases to support centralized authorization
checks. The client needs to make sure to submit its service
identity as part of its request, while the service needs to
carry out the authorization check based on that service
identity to determine if it request should be processed or not.</p>
<h3 id="client-changes">Client Changes<a class="headerlink" href="#client-changes" title="Permanent link">&para;</a></h3>
<hr />
<p>While we'll use the <code>curl</code> client to make the http calls
to our example service, we provide a sample client code
that utilizes our zmssvctoken go library to generate
service identity tokens. The full client source code is
available from:</p>
<p><a href="https://github.com/AthenZ/athenz/blob/master/utils/zms-svctoken/zms-svctoken.go">https://github.com/AthenZ/athenz/blob/master/utils/zms-svctoken/zms-svctoken.go</a></p>
<h4 id="client-import-dependency-update">Client Import Dependency Update<a class="headerlink" href="#client-import-dependency-update" title="Permanent link">&para;</a></h4>
<hr />
<p>First you need to update your go client to import the zms service
token library.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;github.com/AthenZ/athenz/libs/go/zmssvctoken&quot;</span>
<span class="p">)</span>
</code></pre></div>
<h4 id="obtaining-ntokens">Obtaining NTokens<a class="headerlink" href="#obtaining-ntokens" title="Permanent link">&para;</a></h4>
<hr />
<p>The domain administrator must have already generated a public/private key pair
for the service and registered public key in Athenz. The private key must be
available on the host where the client will be running.</p>
<div class="highlight"><pre><span></span><code>    <span class="c1">// load private key</span>
    <span class="nx">bytes</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nx">ReadFile</span><span class="p">(</span><span class="nx">privateKeyFile</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// get token builder instance</span>
    <span class="nx">builder</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">zmssvctoken</span><span class="p">.</span><span class="nx">NewTokenBuilder</span><span class="p">(</span><span class="nx">domain</span><span class="p">,</span> <span class="nx">service</span><span class="p">,</span> <span class="nx">bytes</span><span class="p">,</span> <span class="nx">keyVersion</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// set optional attributes</span>
    <span class="nx">builder</span><span class="p">.</span><span class="nx">SetExpiration</span><span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Minute</span><span class="p">)</span>

    <span class="nx">tok</span> <span class="o">:=</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">Token</span><span class="p">()</span>

    <span class="c1">// get a token for use</span>
    <span class="nx">ntoken</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">tok</span><span class="p">.</span><span class="nx">Value</span><span class="p">()</span>
</code></pre></div>
<p>Once we have our ntoken value, the http client before contacting the
provider service needs to add it as the value for the <code>Athenz-Principal-Auth</code>
header:</p>
<div class="highlight"><pre><span></span><code>    <span class="nx">req</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">NewRequest</span><span class="p">(</span><span class="s">&quot;GET&quot;</span><span class="p">,</span> <span class="s">&quot;http://recommend-host/rec/v1/movie&quot;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
    <span class="c1">// ...</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">Header</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="s">&quot;Athenz-Principal-Auth&quot;</span><span class="p">,</span> <span class="nx">ntoken</span><span class="p">)</span>
</code></pre></div>
<h4 id="build-go-zms_svctoken-client-utility">Build Go zms_svctoken Client Utility<a class="headerlink" href="#build-go-zms_svctoken-client-utility" title="Permanent link">&para;</a></h4>
<hr />
<p>To download, compile and install zms_svctoken utility, execute
the following command:</p>
<div class="highlight"><pre><span></span><code>$ go get github.com/AthenZ/athenz/utils/zms-svctoken/...
</code></pre></div>
<h3 id="server-changes">Server Changes<a class="headerlink" href="#server-changes" title="Permanent link">&para;</a></h3>
<hr />
<p>The full server source code is available from:</p>
<p><a href="https://github.com/AthenZ/athenz/tree/master/examples/go/centralized-use-case/server">https://github.com/AthenZ/athenz/tree/master/examples/go/centralized-use-case/server</a></p>
<h4 id="server-import-dependency-update">Server Import Dependency Update<a class="headerlink" href="#server-import-dependency-update" title="Permanent link">&para;</a></h4>
<hr />
<p>First you need to update your go client to import the zms client
library.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;github.com/AthenZ/athenz/clients/go/zms&quot;</span>
<span class="p">)</span>
</code></pre></div>
<h4 id="authorization-checks">Authorization Checks<a class="headerlink" href="#authorization-checks" title="Permanent link">&para;</a></h4>
<hr />
<p>Before any authorization calls, we're going to check to make sure
our request contains the Athenz principal token:</p>
<div class="highlight"><pre><span></span><code>    <span class="kd">const</span> <span class="nx">authHeader</span> <span class="p">=</span> <span class="s">&quot;Athenz-Principal-Auth&quot;</span>

    <span class="kd">func</span> <span class="nx">movieHandler</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// first let&#39;s verify that we have an ntoken</span>
        <span class="k">if</span> <span class="nx">r</span><span class="p">.</span><span class="nx">Header</span><span class="p">[</span><span class="nx">authHeader</span><span class="p">]</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nx">http</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&quot;403 - Missing NToken&quot;</span><span class="p">,</span> <span class="mi">403</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="o">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Next, the most important part is to determine the resource and action
based on the given http request. Since we have a separate handler for
each endpoint:</p>
<div class="highlight"><pre><span></span><code>    <span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/rec/v1/movie&quot;</span><span class="p">,</span> <span class="nx">movieHandler</span><span class="p">)</span>
    <span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/rec/v1/tvshow&quot;</span><span class="p">,</span> <span class="nx">tvshowHandler</span><span class="p">)</span>
</code></pre></div>
<p>each function knows exactly what the resource and the action is.
Finally, we are going to contact ZMS for the authorization check.</p>
<div class="highlight"><pre><span></span><code>    <span class="kd">func</span> <span class="nx">movieHandler</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">...</span>
        <span class="c1">// let&#39;s generate our resource value which is the</span>
        <span class="c1">// &lt;provider domain&gt;:&lt;entity value&gt;</span>
        <span class="nx">resource</span> <span class="o">:=</span> <span class="nx">providerDomain</span> <span class="o">+</span> <span class="s">&quot;:rec.movie&quot;</span>

        <span class="c1">// let&#39;s check with ZMS if the principal is authorized</span>
        <span class="k">if</span> <span class="p">!</span><span class="nx">authorizeRequest</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Header</span><span class="p">[</span><span class="nx">authHeader</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nx">resource</span><span class="p">,</span> <span class="s">&quot;read&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">http</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&quot;403 - Unauthorized access&quot;</span><span class="p">,</span> <span class="mi">403</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="nx">io</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&quot;Name: Slap Shot; Director: George Roy Hill\n&quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nx">authorizeRequest</span><span class="p">(</span><span class="nx">ntoken</span><span class="p">,</span> <span class="nx">resource</span><span class="p">,</span> <span class="nx">action</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
        <span class="c1">// for our test example we&#39;re just going to skip</span>
        <span class="c1">// validating self-signed certificates</span>
        <span class="nx">tr</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">Transport</span><span class="p">{}</span>
        <span class="nx">config</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">tls</span><span class="p">.</span><span class="nx">Config</span><span class="p">{}</span>
        <span class="nx">config</span><span class="p">.</span><span class="nx">InsecureSkipVerify</span> <span class="p">=</span> <span class="kc">true</span>
        <span class="nx">tr</span><span class="p">.</span><span class="nx">TLSClientConfig</span> <span class="p">=</span> <span class="nx">config</span>
        <span class="nx">zmsClient</span> <span class="o">:=</span> <span class="nx">zms</span><span class="p">.</span><span class="nx">ZMSClient</span><span class="p">{</span>
                <span class="nx">URL</span><span class="p">:</span>       <span class="nx">zmsUrl</span><span class="p">,</span>
                <span class="nx">Transport</span><span class="p">:</span> <span class="o">&amp;</span><span class="nx">tr</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="nx">zmsClient</span><span class="p">.</span><span class="nx">AddCredentials</span><span class="p">(</span><span class="nx">authHeader</span><span class="p">,</span> <span class="nx">ntoken</span><span class="p">)</span>
        <span class="nx">access</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">zmsClient</span><span class="p">.</span><span class="nx">GetAccess</span><span class="p">(</span><span class="nx">zms</span><span class="p">.</span><span class="nx">ActionName</span><span class="p">(</span><span class="nx">action</span><span class="p">),</span> <span class="nx">zms</span><span class="p">.</span><span class="nx">ResourceName</span><span class="p">(</span><span class="nx">resource</span><span class="p">),</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Unable to verify access: %v&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">false</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">access</span><span class="p">.</span><span class="nx">Granted</span>
    <span class="p">}</span>
</code></pre></div>
<h4 id="build-server">Build Server<a class="headerlink" href="#build-server" title="Permanent link">&para;</a></h4>
<hr />
<p>Checkout and build the server component:</p>
<div class="highlight"><pre><span></span><code>$ go get github.com/AthenZ/athenz/examples/go/centralized-use-case/server
</code></pre></div>
<h2 id="deploying-example-server">Deploying Example Server<a class="headerlink" href="#deploying-example-server" title="Permanent link">&para;</a></h2>
<hr />
<p>To run the Go server, you just need to specify the ZMS Server url.
The server listens on port 8080:</p>
<div class="highlight"><pre><span></span><code>$ recommend -zms https://&lt;zms-server&gt;:4443/zms/v1
</code></pre></div>
<h2 id="test-cases">Test Cases<a class="headerlink" href="#test-cases" title="Permanent link">&para;</a></h2>
<hr />
<p>Run the following test cases to verify authorization access
for specific services. We're running our go server on the local
box so we're using localhost as the hostname.</p>
<ul>
<li>The zms_svctoken utility should already be built and installed
on your host.  <code>cd</code> to the directory that includes the private keys for the test
services we created in the section <a href="#athenz-management-setup">Athenz Management Setup</a>
above.</li>
</ul>
<h3 id="invalid-access-without-servicetoken">Invalid Access Without ServiceToken<a class="headerlink" href="#invalid-access-without-servicetoken" title="Permanent link">&para;</a></h3>
<hr />
<p>For this test case we'll just use the curl client directly:</p>
<div class="highlight"><pre><span></span><code>$ curl http://localhost:8080/rec/v1/movie
<span class="m">403</span> - Missing NToken
</code></pre></div>
<h3 id="movie-editor-access">Movie Editor Access<a class="headerlink" href="#movie-editor-access" title="Permanent link">&para;</a></h3>
<hr />
<p>Movie service can successfully access /rec/v1/movie endpoint. So let's
first generate an NToken for this service and then contact our server:</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">export</span> <span class="nv">NTOKEN</span><span class="o">=</span><span class="sb">`</span>zms_svctoken -domain editors -service movie -private-key movie_private.pem -key-version v0<span class="sb">`</span>
$ curl -H <span class="s2">&quot;Athenz-Principal-Auth: </span><span class="nv">$NTOKEN</span><span class="s2">&quot;</span> http://localhost:8080/rec/v1/movie
Name: Slap Shot<span class="p">;</span> Director: George Roy Hill
</code></pre></div>
<p>Movie service does not have access to /rec/v1/tvshow endpoint:</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">export</span> <span class="nv">NTOKEN</span><span class="o">=</span><span class="sb">`</span>zms_svctoken -domain editors -service movie -private-key movie_private.pem -key-version v0<span class="sb">`</span>
$ curl -H <span class="s2">&quot;Athenz-Principal-Auth: </span><span class="nv">$NTOKEN</span><span class="s2">&quot;</span> http://localhost:8080/rec/v1/tvshow
<span class="m">403</span> - Unauthorized access
</code></pre></div>
<h3 id="tvshow-editor-access">TvShow Editor Access<a class="headerlink" href="#tvshow-editor-access" title="Permanent link">&para;</a></h3>
<hr />
<p>TvShow service can successfully access /rec/v1/tvshow endpoint. So let's
first generate an NToken for this service and then contact our server:</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">export</span> <span class="nv">NTOKEN</span><span class="o">=</span><span class="sb">`</span>zms_svctoken -domain editors -service tvshow -private-key tvshow_private.pem -key-version v0<span class="sb">`</span>
$ curl -H <span class="s2">&quot;Athenz-Principal-Auth: </span><span class="nv">$NTOKEN</span><span class="s2">&quot;</span> http://localhost:8080/rec/v1/tvshow
Name: Middle<span class="p">;</span> Channel: ABC
</code></pre></div>
<p>TvShow service does not have access to /rec/v1/movie endpoint:</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">export</span> <span class="nv">NTOKEN</span><span class="o">=</span><span class="sb">`</span>zms_svctoken -domain editors -service tvshow -private-key tvshow_private.pem -key-version v0<span class="sb">`</span>
$ curl -H <span class="s2">&quot;Athenz-Principal-Auth: </span><span class="nv">$NTOKEN</span><span class="s2">&quot;</span> http://localhost:8080/rec/v1/movie
<span class="m">403</span> - Unauthorized access
</code></pre></div>
<h3 id="site-editor-access">Site Editor Access<a class="headerlink" href="#site-editor-access" title="Permanent link">&para;</a></h3>
<hr />
<p>Site service has access to both /rec/v1/tvshow and /rec/v1/movie endpoints:</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">export</span> <span class="nv">NTOKEN</span><span class="o">=</span><span class="sb">`</span>zms_svctoken -domain editors -service site -private-key site_private.pem -key-version v0<span class="sb">`</span>
$ curl -H <span class="s2">&quot;Athenz-Principal-Auth: </span><span class="nv">$NTOKEN</span><span class="s2">&quot;</span> http://localhost:8080/rec/v1/movie
Name: Slap Shot<span class="p">;</span> Director: George Roy Hill

$ curl -H <span class="s2">&quot;Athenz-Principal-Auth: </span><span class="nv">$NTOKEN</span><span class="s2">&quot;</span> http://localhost:8080/rec/v1/tvshow
Name: Middle<span class="p">;</span> Channel: ABC
</code></pre></div>
<h3 id="other-test-cases">Other Test Cases<a class="headerlink" href="#other-test-cases" title="Permanent link">&para;</a></h3>
<hr />
<p>Now you can modify the <code>movie_editos, tvshow_editors, and site_editors</code> roles
in the <code>recommend</code> domain to add and remove the defined services and then
run the corresponding test cases to verify your access change.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../example_java_centralized_access/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Java Client/Servlet Centralized Example
              </div>
            </div>
          </a>
        
        
          <a href="../example_java_decentralized_access/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Java Client/Servlet Decentralized Example
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.77e55a48.min.js"></script>
      <script src="../assets/javascripts/bundle.9554a270.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>