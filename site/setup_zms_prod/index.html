



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Athenz User Guide">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.1.0">
    
    
      
        <title>ZMS Server - Athenz</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.11e41852.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.20ef595d.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#setup-zms-authorization-management-system-for-production" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Athenz" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Athenz
              </span>
              <span class="md-header-nav__topic">
                ZMS Server
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/yahoo/athenz/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Athenz" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Athenz
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/yahoo/athenz/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1" checked>
    
    <label class="md-nav__link" for="nav-1">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href=".." title="About" class="md-nav__link">
      About
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dev_environment/" title="Development Environment" class="md-nav__link">
      Development Environment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-3" type="checkbox" id="nav-1-3">
    
    <label class="md-nav__link" for="nav-1-3">
      Local/Development Environment Setup
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-1-3">
        Local/Development Environment Setup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../setup_zms/" title="ZMS Server" class="md-nav__link">
      ZMS Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../setup_zts/" title="ZTS Server" class="md-nav__link">
      ZTS Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../setup_ui/" title="UI Server" class="md-nav__link">
      UI Server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-4" type="checkbox" id="nav-1-4" checked>
    
    <label class="md-nav__link" for="nav-1-4">
      Production Environment Setup
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-1-4">
        Production Environment Setup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        ZMS Server
      </label>
    
    <a href="./" title="ZMS Server" class="md-nav__link md-nav__link--active">
      ZMS Server
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requirements" title="Requirements" class="md-nav__link">
    Requirements
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jdk-8" title="JDK 8" class="md-nav__link">
    JDK 8
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql-server" title="MySQL Server" class="md-nav__link">
    MySQL Server
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zms-server-schema-setup" title="ZMS Server Schema Setup" class="md-nav__link">
    ZMS Server Schema Setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql-user-and-permissions" title="MySQL User and Permissions" class="md-nav__link">
    MySQL User and Permissions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-software" title="Getting Software" class="md-nav__link">
    Getting Software
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" title="Configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#db-access" title="DB Access" class="md-nav__link">
    DB Access
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#private-key" title="Private Key" class="md-nav__link">
    Private Key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server-x509-certificate" title="Server X509 Certificate" class="md-nav__link">
    Server X509 Certificate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-authentication" title="User Authentication" class="md-nav__link">
    User Authentication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#system-administrators" title="System Administrators" class="md-nav__link">
    System Administrators
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#startstop-zms-server" title="Start/Stop ZMS Server" class="md-nav__link">
    Start/Stop ZMS Server
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../setup_zts_prod/" title="ZTS Server" class="md-nav__link">
      ZTS Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../setup_ui_prod/" title="UI Server" class="md-nav__link">
      UI Server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      AWS Setup
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        AWS Setup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../aws_athenz_setup/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aws_zms_setup/" title="ZMS Server" class="md-nav__link">
      ZMS Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aws_zts_setup/" title="ZTS Server" class="md-nav__link">
      ZTS Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aws_ui_setup/" title="UI Server" class="md-nav__link">
      UI Server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Architecture
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Architecture
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../data_model/" title="Data Model" class="md-nav__link">
      Data Model
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../system_view/" title="System View" class="md-nav__link">
      System View
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../auth_flow/" title="Authorization Flow" class="md-nav__link">
      Authorization Flow
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Features
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Features
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../copper_argos/" title="Service Identity X.509 Certificates - Copper Argos" class="md-nav__link">
      Service Identity X.509 Certificates - Copper Argos
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Developer Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Developer Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../dev_centralized_access/" title="Centralized Access Control" class="md-nav__link">
      Centralized Access Control
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../example_java_centralized_access/" title="Java Client/Servlet Example" class="md-nav__link">
      Java Client/Servlet Example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../example_go_centralized_access/" title="Go Client/Server Example" class="md-nav__link">
      Go Client/Server Example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dev_decentralized_access/" title="Decentralized Access Control" class="md-nav__link">
      Decentralized Access Control
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../example_java_decentralized_access/" title="Java Client/Servlet Example" class="md-nav__link">
      Java Client/Servlet Example
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Customizing Athenz
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Customizing Athenz
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../principal_authentication/" title="Principal Authentication" class="md-nav__link">
      Principal Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../private_key_store/" title="Private Key Store" class="md-nav__link">
      Private Key Store
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cert_signer/" title="Certificate Signer" class="md-nav__link">
      Certificate Signer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../copper_argos_dev/" title="Service Identity X.509 Certificate Support Requirements - Copper Argos" class="md-nav__link">
      Service Identity X.509 Certificate Support Requirements - Copper Argos
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      User Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        User Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../zms_client/" title="ZMS Client Utility" class="md-nav__link">
      ZMS Client Utility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../setup_zpu/" title="ZPU Utility" class="md-nav__link">
      ZPU Utility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../reg_service_guide/" title="Registering ZMS Service Identity" class="md-nav__link">
      Registering ZMS Service Identity
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requirements" title="Requirements" class="md-nav__link">
    Requirements
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jdk-8" title="JDK 8" class="md-nav__link">
    JDK 8
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql-server" title="MySQL Server" class="md-nav__link">
    MySQL Server
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zms-server-schema-setup" title="ZMS Server Schema Setup" class="md-nav__link">
    ZMS Server Schema Setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql-user-and-permissions" title="MySQL User and Permissions" class="md-nav__link">
    MySQL User and Permissions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-software" title="Getting Software" class="md-nav__link">
    Getting Software
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" title="Configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#db-access" title="DB Access" class="md-nav__link">
    DB Access
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#private-key" title="Private Key" class="md-nav__link">
    Private Key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server-x509-certificate" title="Server X509 Certificate" class="md-nav__link">
    Server X509 Certificate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-authentication" title="User Authentication" class="md-nav__link">
    User Authentication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#system-administrators" title="System Administrators" class="md-nav__link">
    System Administrators
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#startstop-zms-server" title="Start/Stop ZMS Server" class="md-nav__link">
    Start/Stop ZMS Server
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/yahoo/athenz/edit/master/docs/setup_zms_prod.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="setup-zms-authorization-management-system-for-production">Setup ZMS (AuthoriZation Management System) For Production</h1>
<hr />
<p>The primary requirement for running ZMS in a Production environment is
using JDBC (MySQL Server) to store the domain data as opposed to
file based json documents.</p>
<ul>
<li><a href="#requirements">Requirements</a><ul>
<li><a href="#jdk-8">JDK 8</a></li>
<li><a href="#mysql-server">MySQL Server</a><ul>
<li><a href="#zms-server-schema-setup">ZMS Server Schema Setup</a></li>
<li><a href="#mysql-user-and-permissions">MySQL User and Permissions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#getting-software">Getting Software</a></li>
<li><a href="#configuration">Configuration</a><ul>
<li><a href="#db-access">DB Access</a></li>
<li><a href="#private-key">Private Key</a></li>
<li><a href="#server-x509-certificate">Server X509 Certificate</a></li>
<li><a href="#user-authentication">User Authentication</a></li>
<li><a href="#system-administrators">System Administrators</a></li>
</ul>
</li>
<li><a href="#startstop-zms-server">Start/Stop ZMS Server</a></li>
</ul>
<h2 id="requirements">Requirements</h2>
<hr />
<p>The following tools are required to be installed on hosts
configured to run ZMS server.</p>
<h3 id="jdk-8">JDK 8</h3>
<hr />
<p>ZMS Server is written in Java and using embedded Jetty.</p>
<p><a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">Oracle Java Platform JDK 8</a></p>
<p>While ZMS has been developed and tested with Oracle Java Platform JDK 8
it should run successfully with OpenJDK 8 as well.</p>
<h3 id="mysql-server">MySQL Server</h3>
<hr />
<p>On a separate host, download and install the latest version
of <a href="https://dev.mysql.com/downloads/mysql/">MySQL Server</a></p>
<h4 id="zms-server-schema-setup">ZMS Server Schema Setup</h4>
<hr />
<p>Copy the <code>zms_server.sql</code> file from the Athenz Git repository (from the
servers/zms/schema directory) onto this host and create the database:</p>
<div class="codehilite"><pre><span></span>$ mysql -u root &lt; zms_server.sql
</pre></div>


<h4 id="mysql-user-and-permissions">MySQL User and Permissions</h4>
<hr />
<p>Follow MySQL documentation to create a user and grant this user full
privileges over the zms_server database created. For example, let's assume
our ZMS Server will be running on zms1.athenz.com host and we want to
create a user called zms_admin with password "rdvXC7wgvm3g":</p>
<div class="codehilite"><pre><span></span>$ mysql -u root
mysql&gt; CREATE USER <span class="s1">&#39;zms_admin&#39;</span>@<span class="s1">&#39;zms1.athenz.com&#39;</span> IDENTIFIED BY <span class="s1">&#39;rdvXC7wgvm3g&#39;</span><span class="p">;</span>
mysql&gt; GRANT ALL PRIVILEGES ON zms_server.* TO <span class="s1">&#39;zms_admin&#39;</span>@<span class="s1">&#39;zms1.athenz.com&#39;</span><span class="p">;</span>
mysql&gt; FLUSH PRIVILEGES<span class="p">;</span>
</pre></div>


<p>We recommend to have a strong admin password for better security.</p>
<h2 id="getting-software">Getting Software</h2>
<hr />
<p>Download latest ZMS binary release from</p>
<div class="codehilite"><pre><span></span>https://bintray.com/yahoo/maven/athenz-zms/_latestVersion#files
</pre></div>


<div class="codehilite"><pre><span></span>$ tar xvfz athenz-zms-X.Y-bin.tar.gz
$ <span class="nb">cd</span> athenz-zms-X.Y
</pre></div>


<h2 id="configuration">Configuration</h2>
<hr />
<p>To run ZMS Server, the system administrator must generate the keys
and make necessary changes to the configuration settings.</p>
<h3 id="db-access">DB Access</h3>
<hr />
<p>In the "MySQL Server" section above we installed and configured the
schema required for ZMS Server. We also created a zms admin user and
granted full access over those tables. Now, we need to configure the
ZMS with those access details:</p>
<div class="codehilite"><pre><span></span>$ <span class="nb">cd</span> conf/zms_server
$ vi zms.properties
</pre></div>


<p>Make the following changes:</p>
<ol>
<li>Configure the ZMS Server to use JDBC object store implementation.
   Uncomment the <code>#athenz.zms.object_store_factory_class=</code> line and set
   it to point to the JDBC Factory class name. It should be set to:</li>
</ol>
<p>athenz.zms.object_store_factory_class=com.yahoo.athenz.zms.store.impl.JDBCObjectStoreFactory</p>
<ol>
<li>Uncomment the <code>#athenz.zms.jdbcstore=</code> line and set it to point to your
   MySQL Server instance. For example if your DB Server is running on
   a host called db1.athenz.com, then your line would be:</li>
</ol>
<p>athenz.zms.jdbc_store=jdbc:mysql://db1.athenz.com:3306/zms_server</p>
<ol>
<li>Uncomment the <code>#athenz.zms.jdbc_user=</code> line and set it to the user
   configured to have full access over zms server database:</li>
</ol>
<p>athenz.zms.jdbc_user=zms_admin</p>
<ol>
<li>Uncomment the <code>#athenz.zms.jdbc_password=</code> line and set it to the
   configured password the for the jdbc user with full access:</li>
</ol>
<p>athenz.zms.jdbc_password=rdvXC7wgvm3g</p>
<p>Storing the password in property file is not secure. The more robust approach
is to use a Key Management Store like HashiCorp Vault to store your passwords.
Athenz provides a PrivateKeyStoreFactory interface for accessing secrets from
your key management store. The recommended approach would to write your own
implementation of this interface and configure ZMS server to use that factory
to fetch the password for your database access. ZMS Server expect the private
key store factory implementation class name in its
<code>athenz.zms.private_key_store_factory_class</code> system property.</p>
<p>Refer to <a href="../private_key_store/">Private Key Store</a> section for
full details how to implement your private key store.</p>
<p>When storing the jdbc user password for your database access in your key management
store with a given keyname like <code>athenz.admin_db_password</code> and using your own
implementation of the PrivateKeyStoreFactory, then the value of the
<code>athenz.zms.jdbc_password</code> property would be the key name. For example:</p>
<div class="codehilite"><pre><span></span>athenz.zms.jdbc_password=athenz.admin_db_password
</pre></div>


<p>The password is retrieved using the <code>getApplicationSecret()</code> of your private
key store class that takes keyName (<code>athenz.admin_db_password</code> in this case)
as input and returns key value that is your configured password.</p>
<h3 id="private-key">Private Key</h3>
<hr />
<p>Generate a unique private key that ZMS Server will use
to sign any NTokens it issues. From the <code>athenz-zms-X.Y</code> directory
execute the following commands:</p>
<div class="codehilite"><pre><span></span>$ <span class="nb">cd</span> var/zms_server/keys
$ openssl genrsa -out zms_private.pem <span class="m">2048</span>
</pre></div>


<p>If you have multiple ZMS servers in your environment, your private key
must be stored in your key management store and securely installed
on all hosts where ZMS servers will be running in the specified
directory.</p>
<h3 id="server-x509-certificate">Server X509 Certificate</h3>
<hr />
<p>While it is still possible to generate and use a self-signed X509 
certificate for ZMS Servers, it is recommended to purchase one for
your production server from a well known certificate authority.
Having such a certificate installed on your ZMS Servers will no
longer require to distribute the server's CA certificate to
other hosts (e.g. ZTS Servers, Hosts running ZPU).</p>
<p>Follow the instructions provided by the Certificate Authority that
you're going to purchase your certificate from to
generate your private key and then the Certificate Request (CSR).
Once you have received your X509 certificate, we just need to add
that certificate along with its private key to a keystore for Jetty 
use. From the <code>athenz-zms-X.Y</code> directory execute the following
command:</p>
<div class="codehilite"><pre><span></span>$ openssl pkcs12 -export -out zms_keystore.pkcs12 -in zms_cert.pem -inkey zms_key.pem
</pre></div>


<h3 id="user-authentication">User Authentication</h3>
<hr />
<p>For a user to authenticate himself/herself in ZMS, the server must have
the appropriate authentication authority implementation configured. By
default, ZMS enables the following two authorities:</p>
<ul>
<li>Unix User Authority - using pam login profile to authenticate users</li>
<li>Principal Authority - validating Principal Tokens that are issued
  when users authenticate using their unix login password.</li>
</ul>
<p>The server also provides other authorities - e.g. Kerberos, TLS Certificate
that are not enabled by default. Since the default setup includes Unix
Authority, the user that the ZMS process runs as must have read access
to the /etc/shadow file. There are two options available:</p>
<ul>
<li>Create a special Unix group that has read access to the /etc/shadow file
  and set the user that the ZMS process will be running as a member of that
  group.</li>
<li>Run the process as root using sudo. This is not recommended for a
  production installation.</li>
</ul>
<p>To add your own authentication authority modify the <code>athenz.zms.authority_classes=com.yahoo.athenz.auth.impl.PrincipalAuthority,com.yahoo.athenz.auth.impl.UserAuthority</code> line and include comma
separated list of authority implementation classes to support.</p>
<h3 id="system-administrators">System Administrators</h3>
<hr />
<p>When running the server very first time, ZMS Server automatically creates
the required domains and sets the running user as the system administrator.
The system administrators are the only ones authorized to create top
level domains in Athenz. Before running the server very first time, you
can configure the set of system administrators by following these steps:</p>
<div class="codehilite"><pre><span></span>$ <span class="nb">cd</span> athenz-zms-X.Y
$ vi conf/zms_server/zms.properties
</pre></div>


<p>Modify the <code>athenz.zms.domain_admin=user.${USER}</code> line and include comma
separated list of unix user ids that should be set as Athenz system
administrators. e.g. <code>athenz.zms.domain_admin=user.joe,user.john</code></p>
<h2 id="startstop-zms-server">Start/Stop ZMS Server</h2>
<hr />
<p>Start the ZMS Server by executing:</p>
<div class="codehilite"><pre><span></span>$ <span class="nb">cd</span> athenz-zms-X.Y
$ bin/zms start
</pre></div>


<p>If using the Unix Authority to authenticate users against their unix password,
make sure the user that the ZMS Server process is running as has read
access to the /etc/shadow file. For full details, please check out
the <code>User Authentication</code> section above.</p>
<p>Based on the sample configuration file provided, ZMS Server will be listening
on port 4443.</p>
<p>Stop the ZMS Server by executing:</p>
<div class="codehilite"><pre><span></span>$ <span class="nb">cd</span> athenz-zms-X.Y
$ bin/zms stop
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../setup_ui/" title="UI Server" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                UI Server
              </span>
            </div>
          </a>
        
        
          <a href="../setup_zts_prod/" title="ZTS Server" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                ZTS Server
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.9e1f3b71.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>