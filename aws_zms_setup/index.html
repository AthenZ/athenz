


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Athenz User Guide">
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.7">
    
    
      
        <title>ZMS Server - Athenz</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.b8ac9624.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#setup-zms-on-aws" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Athenz" class="md-header-nav__button md-logo" aria-label="Athenz">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Athenz
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              ZMS Server
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/yahoo/athenz/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Athenz" class="md-nav__button md-logo" aria-label="Athenz">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Athenz
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/yahoo/athenz/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Getting Started
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href=".." title="About" class="md-nav__link">
      About
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dev_environment/" title="Development Environment" class="md-nav__link">
      Development Environment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-1-3" type="checkbox" id="nav-1-3">
    
    <label class="md-nav__link" for="nav-1-3">
      Local/Development Environment Setup
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Local/Development Environment Setup" data-md-level="2">
      <label class="md-nav__title" for="nav-1-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Local/Development Environment Setup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../setup_zms/" title="ZMS Server" class="md-nav__link">
      ZMS Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../setup_zts/" title="ZTS Server" class="md-nav__link">
      ZTS Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../setup_ui/" title="UI Server" class="md-nav__link">
      UI Server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-1-4" type="checkbox" id="nav-1-4">
    
    <label class="md-nav__link" for="nav-1-4">
      Production Environment Setup
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Production Environment Setup" data-md-level="2">
      <label class="md-nav__title" for="nav-1-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Production Environment Setup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../setup_zms_prod/" title="ZMS Server" class="md-nav__link">
      ZMS Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../setup_zts_prod/" title="ZTS Server" class="md-nav__link">
      ZTS Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../setup_ui_prod/" title="UI Server" class="md-nav__link">
      UI Server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-1-5" type="checkbox" id="nav-1-5">
    
    <label class="md-nav__link" for="nav-1-5">
      Service Identity Registration
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Service Identity Registration" data-md-level="2">
      <label class="md-nav__title" for="nav-1-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Service Identity Registration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../service_x509_credentials/" title="Using X.509 Certificates" class="md-nav__link">
      Using X.509 Certificates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../reg_service_guide/" title="Using Public/Private Key Pairs" class="md-nav__link">
      Using Public/Private Key Pairs
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Management
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Management" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Management
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../role_delegation/" title="Role Delegation" class="md-nav__link">
      Role Delegation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../token_expiration/" title="Access token Limit Expiry Support" class="md-nav__link">
      Access token Limit Expiry Support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../role_cert_expiration/" title="Role Certificate Limit Expiry Support" class="md-nav__link">
      Role Certificate Limit Expiry Support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../review_enabled_roles/" title="Review Enabled Roles" class="md-nav__link">
      Review Enabled Roles
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../email_notifications/" title="Email Notifications" class="md-nav__link">
      Email Notifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../member_expiration/" title="Role Member Auto Expiry and Notification Support" class="md-nav__link">
      Role Member Auto Expiry and Notification Support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../member_soft_expiration/" title="Role Member Review Reminder Support" class="md-nav__link">
      Role Member Review Reminder Support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../self_serve_roles/" title="Self-Served Roles" class="md-nav__link">
      Self-Served Roles
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../athenz_templates/" title="Athenz Templates" class="md-nav__link">
      Athenz Templates
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Authentication
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Authentication" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Authentication
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../service_x509_credentials_aws/" title="Athenz Service Identity X.509 Certificate for AWS EC2 instances" class="md-nav__link">
      Athenz Service Identity X.509 Certificate for AWS EC2 instances
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../service_x509_credentials_aws_ecs/" title="Athenz Service Identity X.509 Certificate for AWS ECS containers" class="md-nav__link">
      Athenz Service Identity X.509 Certificate for AWS ECS containers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../service_x509_credentials_aws_fargate/" title="Athenz Service Identity X.509 Certificate for AWS Fargate tasks" class="md-nav__link">
      Athenz Service Identity X.509 Certificate for AWS Fargate tasks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../service_x509_credentials_aws_eks/" title="Athenz Service Identity X.509 Certificate for AWS EKS pods" class="md-nav__link">
      Athenz Service Identity X.509 Certificate for AWS EKS pods
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../service_x509_credentials_aws_lambda/" title="Athenz Service Identity X.509 Certificate for AWS Lambda functions" class="md-nav__link">
      Athenz Service Identity X.509 Certificate for AWS Lambda functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../zts_access_token_guide/" title="Obtaining OAuth2 Access Tokens from ZTS" class="md-nav__link">
      Obtaining OAuth2 Access Tokens from ZTS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      AWS Setup
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="AWS Setup" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        AWS Setup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../aws_temp_creds/" title="AWS Temp Credentials" class="md-nav__link">
      AWS Temp Credentials
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aws_athenz_setup/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        ZMS Server
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="ZMS Server" class="md-nav__link md-nav__link--active">
      ZMS Server
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#iam-role-setup" class="md-nav__link">
    IAM Role Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#s3-bucket-for-elb-access-logs" class="md-nav__link">
    S3 Bucket for ELB Access Logs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vpc-setup" class="md-nav__link">
    VPC Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rds-setup" class="md-nav__link">
    RDS Setup
  </a>
  
    <nav class="md-nav" aria-label="RDS Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-aurora-mysql-cluster" class="md-nav__link">
    Create Aurora MySQL cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schema-setup" class="md-nav__link">
    Schema Setup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-s3-bucket-to-store-zms-data" class="md-nav__link">
    Create S3 Bucket to Store ZMS Data
  </a>
  
    <nav class="md-nav" aria-label="Create S3 Bucket to Store ZMS Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generate-and-upload-service-private-key-and-id" class="md-nav__link">
    Generate and Upload Service Private Key and Id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upload-server-x509-cert-and-key" class="md-nav__link">
    Upload Server X.509 Cert and Key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upload-rds-ca-certs" class="md-nav__link">
    Upload RDS CA Certs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upload-truststore-password" class="md-nav__link">
    Upload truststore password
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upload-zms-db-user-password" class="md-nav__link">
    Upload ZMS DB User Password
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-s3-bucket-for-audit-logs" class="md-nav__link">
    Create S3 Bucket for Audit Logs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-variables-and-properties" class="md-nav__link">
    Configure Variables and Properties
  </a>
  
    <nav class="md-nav" aria-label="Configure Variables and Properties">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#edit-aws_initsh" class="md-nav__link">
    Edit aws_init.sh
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edit-zmsproperties-file" class="md-nav__link">
    Edit zms.properties file
  </a>
  
    <nav class="md-nav" aria-label="Edit zms.properties file">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-access" class="md-nav__link">
    Database Access
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-authentication" class="md-nav__link">
    User Authentication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-admins" class="md-nav__link">
    Domain Admins
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edit-athenzproperties-file" class="md-nav__link">
    Edit athenz.properties file
  </a>
  
    <nav class="md-nav" aria-label="Edit athenz.properties file">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#truststore-and-keystore-settings" class="md-nav__link">
    Truststore and Keystore Settings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#packer" class="md-nav__link">
    Packer
  </a>
  
    <nav class="md-nav" aria-label="Packer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#packer-vpc-setup" class="md-nav__link">
    Packer VPC Setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-zms-image" class="md-nav__link">
    Build ZMS image
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-zms" class="md-nav__link">
    Deploy ZMS
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aws_zts_setup/" title="ZTS Server" class="md-nav__link">
      ZTS Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aws_ui_setup/" title="UI Server" class="md-nav__link">
      UI Server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Architecture
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Architecture" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Architecture
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../data_model/" title="Data Model" class="md-nav__link">
      Data Model
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../system_view/" title="System View" class="md-nav__link">
      System View
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../auth_flow/" title="Authorization Flow" class="md-nav__link">
      Authorization Flow
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Features
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Features" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Features
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../copper_argos/" title="Service Identity X.509 Certificates - Copper Argos" class="md-nav__link">
      Service Identity X.509 Certificates - Copper Argos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../capabilities/" title="Athenz Capabilities" class="md-nav__link">
      Athenz Capabilities
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Developer Guide
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Developer Guide" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Developer Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../cent_authz_flow/" title="Centralized Authorization Flow" class="md-nav__link">
      Centralized Authorization Flow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../decent_authz_flow/" title="Decentralized Authorization Flow" class="md-nav__link">
      Decentralized Authorization Flow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../client_side_x509_credentials/" title="Client Side Service Identity Authentication" class="md-nav__link">
      Client Side Service Identity Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../server_side_x509_credentials/" title="Server Side Service Identity Authentication" class="md-nav__link">
      Server Side Service Identity Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../example_java_centralized_access/" title="Java Client/Servlet Example" class="md-nav__link">
      Java Client/Servlet Example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../example_go_centralized_access/" title="Go Client/Server Example" class="md-nav__link">
      Go Client/Server Example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../example_java_decentralized_access/" title="Java Client/Servlet Example" class="md-nav__link">
      Java Client/Servlet Example
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Customizing Athenz
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Customizing Athenz" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Customizing Athenz
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../principal_authentication/" title="Principal Authentication" class="md-nav__link">
      Principal Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../private_key_store/" title="Private Key Store" class="md-nav__link">
      Private Key Store
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cert_signer/" title="Certificate Signer" class="md-nav__link">
      Certificate Signer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../copper_argos_dev/" title="Service Identity X.509 Certificate Support Requirements - Copper Argos" class="md-nav__link">
      Service Identity X.509 Certificate Support Requirements - Copper Argos
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      User Guide
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="User Guide" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        User Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../zms_client/" title="ZMS Client Utility" class="md-nav__link">
      ZMS Client Utility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../setup_zpu/" title="ZPU Utility" class="md-nav__link">
      ZPU Utility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../zts_rolecert/" title="ZTS Role Certificate Client Utility" class="md-nav__link">
      ZTS Role Certificate Client Utility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../zts_accesstoken/" title="ZTS OAuth2 Access Token Client" class="md-nav__link">
      ZTS OAuth2 Access Token Client
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../reg_service_guide/" title="Registering ZMS Service Identity" class="md-nav__link">
      Registering ZMS Service Identity
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      References
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="References" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        References
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../zms_api/" title="ZMS REST API" class="md-nav__link">
      ZMS REST API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../zts_api/" title="ZTS REST API" class="md-nav__link">
      ZTS REST API
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#iam-role-setup" class="md-nav__link">
    IAM Role Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#s3-bucket-for-elb-access-logs" class="md-nav__link">
    S3 Bucket for ELB Access Logs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vpc-setup" class="md-nav__link">
    VPC Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rds-setup" class="md-nav__link">
    RDS Setup
  </a>
  
    <nav class="md-nav" aria-label="RDS Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-aurora-mysql-cluster" class="md-nav__link">
    Create Aurora MySQL cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schema-setup" class="md-nav__link">
    Schema Setup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-s3-bucket-to-store-zms-data" class="md-nav__link">
    Create S3 Bucket to Store ZMS Data
  </a>
  
    <nav class="md-nav" aria-label="Create S3 Bucket to Store ZMS Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generate-and-upload-service-private-key-and-id" class="md-nav__link">
    Generate and Upload Service Private Key and Id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upload-server-x509-cert-and-key" class="md-nav__link">
    Upload Server X.509 Cert and Key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upload-rds-ca-certs" class="md-nav__link">
    Upload RDS CA Certs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upload-truststore-password" class="md-nav__link">
    Upload truststore password
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upload-zms-db-user-password" class="md-nav__link">
    Upload ZMS DB User Password
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-s3-bucket-for-audit-logs" class="md-nav__link">
    Create S3 Bucket for Audit Logs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-variables-and-properties" class="md-nav__link">
    Configure Variables and Properties
  </a>
  
    <nav class="md-nav" aria-label="Configure Variables and Properties">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#edit-aws_initsh" class="md-nav__link">
    Edit aws_init.sh
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edit-zmsproperties-file" class="md-nav__link">
    Edit zms.properties file
  </a>
  
    <nav class="md-nav" aria-label="Edit zms.properties file">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-access" class="md-nav__link">
    Database Access
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-authentication" class="md-nav__link">
    User Authentication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-admins" class="md-nav__link">
    Domain Admins
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edit-athenzproperties-file" class="md-nav__link">
    Edit athenz.properties file
  </a>
  
    <nav class="md-nav" aria-label="Edit athenz.properties file">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#truststore-and-keystore-settings" class="md-nav__link">
    Truststore and Keystore Settings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#packer" class="md-nav__link">
    Packer
  </a>
  
    <nav class="md-nav" aria-label="Packer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#packer-vpc-setup" class="md-nav__link">
    Packer VPC Setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-zms-image" class="md-nav__link">
    Build ZMS image
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-zms" class="md-nav__link">
    Deploy ZMS
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/yahoo/athenz/edit/master/docs/aws_zms_setup.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="setup-zms-on-aws">Setup ZMS on AWS</h1>
<ul>
<li><a href="#iam-role-setup">IAM Role Setup</a></li>
<li><a href="#s3-bucket-for-elb-access-logs">S3 Bucket for ELB Access Logs</a></li>
<li><a href="#vpc-setup">VPC setup</a></li>
<li><a href="#rds-setup">RDS Setup</a><ul>
<li><a href="#create-aurora-mysql-cluster">Create Aurora MySQL Cluster</a></li>
<li><a href="#schema-setup">Schema Setup</a></li>
</ul>
</li>
<li><a href="#create-s3-bucket-to-store-zms-data">S3 Bucket to Store ZMS Data</a><ul>
<li><a href="#generate-and-upload-service-private-key-and-id">Generate and Upload Service Private Key</a></li>
<li><a href="#upload-server-x-509-cert-and-key">Upload Server X.509 Cert and Key</a></li>
<li><a href="#upload-rds-ca-certs">Upload RDS CA Certs</a></li>
<li><a href="#upload-truststore-password">Upload Truststore Password</a> </li>
<li><a href="#upload-zms-db-user-password">Upload ZMS DB User Password</a></li>
</ul>
</li>
<li><a href="#create-s3-bucket-for-audit-logs">Create S3 Bucket for Audit logs</a></li>
<li><a href="#configure-variables-and-properties">Configure Variables and Properties</a><ul>
<li><a href="#edit-aws_init-sh">aws_init.sh</a></li>
<li><a href="#edit-zms-properties-file">zms.properties</a><ul>
<li><a href="#database-access">Database Access</a></li>
<li><a href="#user-authentication">User Authentication</a></li>
<li><a href="#domain-admins">Domain Admins</a></li>
</ul>
</li>
<li><a href="#edit-athenz-properties-file">athenz.properties</a><ul>
<li><a href="#truststore-and-keystore-settings">Truststore and Keystore Settings</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#packer">Packer</a><ul>
<li><a href="#packer-vpc-setup">Packer VPC setup</a></li>
<li><a href="#build-zms-image">Build ZMS Image</a></li>
</ul>
</li>
<li><a href="#deploy-zms">Deploy ZMS</a> </li>
</ul>
<h2 id="iam-role-setup">IAM Role Setup</h2>
<p>Create an EC2 profile role for ZMS using the following <a href="https://github.com/yahoo/athenz/blob/master/aws-setup/zms-setup/cloud-formation/athens-zms-aws-roles-setup.yaml">cloudformation template</a>.
This template creates a role named <code>athenz.zms-service</code>.</p>
<h2 id="s3-bucket-for-elb-access-logs">S3 Bucket for ELB Access Logs</h2>
<p>Create a S3 bucket needed to store ELB access logs with the following bucket policy:</p>
<div class="codehilite"><pre><span></span><code><span class="err">{</span>
<span class="err"> &quot;Version&quot;: &quot;2012-10-17&quot;,</span>
<span class="err"> &quot;Statement&quot;: [</span>
<span class="err">     {</span>
<span class="err">         &quot;Sid&quot;: &quot;&quot;,</span>
<span class="err">         &quot;Effect&quot;: &quot;Allow&quot;,</span>
<span class="err">         &quot;Principal&quot;: {</span>
<span class="err">             &quot;AWS&quot;: &quot;arn:aws:iam::&lt;aws-account-id&gt;:root&quot;</span>
<span class="err">         },</span>
<span class="err">         &quot;Action&quot;: &quot;s3:PutObject&quot;,</span>
<span class="err">         &quot;Resource&quot;: &quot;arn:aws:s3:::&lt;your bucket name&gt;/*/AWSLogs/&lt;aws-account-id&gt;/*&quot;</span>
<span class="err">     }</span>
<span class="err"> ]</span>
<span class="err">}</span>
</code></pre></div>


<p>Refer to <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-access-logs.html#access-logging-bucket-permissions">AWS ELB Documentation</a> for more details on bucket policy.</p>
<h2 id="vpc-setup">VPC Setup</h2>
<p>Setup a VPC using the following <a href="https://github.com/yahoo/athenz/blob/master/aws-setup/zms-setup/cloud-formation/athens-zms-aws-resource-setup.yaml">cloudformation template</a> by giving the these mandatory parameters:</p>
<ul>
<li><code>Route53HostedZoneName</code></li>
<li><code>Route53RecordName</code></li>
<li><code>S3AccessLogBucketName</code> (Created in the previous step)</li>
<li><code>Environment</code></li>
</ul>
<p>The other parameters are set by default. Change them as per your requirements.</p>
<p><em>NOTE - Modifying the other defaults might require subsequent changes.</em></p>
<p>Following resources will be created after executing the template:
1. 2 availability zones
1. Public &amp; Private subnets for each availability zone
1. 2 NAT gateways and elastic IPs
1. NACL's for the subnets
1. Internet gateways for all public subnets
1. Route tables for all subnets
1. Elastic load balancer
1. Route 53 DNS entry
1. ZMS Server and ELB security groups</p>
<h2 id="rds-setup">RDS Setup</h2>
<h3 id="create-aurora-mysql-cluster">Create Aurora MySQL cluster</h3>
<p>Setup an Aurora MySQL compatible cluster using the following <a href="https://github.com/yahoo/athenz/blob/master/aws-setup/zms-setup/cloud-formation/athens-zms-aws-rds-setup.yaml">cloudformation template</a> by giving the following mandatory parameters:</p>
<ul>
<li><code>Route53HostedZoneName</code></li>
<li><code>Route53RecordName</code></li>
<li><code>DatabaseUsername</code></li>
<li><code>DatabasePassword</code></li>
<li><code>Environment</code></li>
</ul>
<p>The other parameters are set by default. Change them as per your requirements.</p>
<h3 id="schema-setup">Schema Setup</h3>
<ul>
<li>Create an EC2 instance in private subnet and ssh login into it. After logging in, install the mysql package and use the following command to connect to the cluster</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">mysql -h &lt;RDS_CLUSTER_ENDPOINT&gt; -P 3306 -u &lt;DB_USER&gt; -p</span>
</code></pre></div>


<ul>
<li>Copy the <a href="https://github.com/yahoo/athenz/blob/master/servers/zms/schema/zms_server.sql">zms_server.sql</a> file from the Athenz Git repository onto this host and create the database using the following command:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">mysql -h &lt;RDS_CLUSTER_ENDPOINT&gt; -P 3306 -u &lt;DB_USER&gt; -p  &lt; zms_server.sql</span>
</code></pre></div>


<ul>
<li>Create a user with full privileges on zms database created above. For e.g. if your ZMS Server will be running on zms1.athenz.com and the user to be created is <code>athenz-zms</code> having password <code>athenz-pass</code>:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">CREATE USER &#39;athenz-zms&#39;@&#39;zms1.athenz.com&#39; IDENTIFIED BY &#39;athenz-pass&#39;;</span>
<span class="err">GRANT ALL PRIVILEGES ON zms_server TO &#39;athenz-zms&#39;@&#39;zms1.athenz.com&#39;;</span>
<span class="err">FLUSH PRIVILEGES;</span>
</code></pre></div>


<h2 id="create-s3-bucket-to-store-zms-data">Create S3 Bucket to Store ZMS Data</h2>
<p>Create a S3 bucket for storing zms certificates &amp; keys among other configuration data with an appropriate policy as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="err">{</span>
<span class="err">&quot;Version&quot;: &quot;2012-10-17&quot;,</span>
<span class="err">&quot;Statement&quot;: [</span>
<span class="err">    {</span>
<span class="err">        &quot;Sid&quot;: &quot;&quot;,</span>
<span class="err">        &quot;Effect&quot;: &quot;Allow&quot;,</span>
<span class="err">        &quot;Principal&quot;: {</span>
<span class="err">            &quot;AWS&quot;: &quot;arn:aws:iam::&lt;aws_account_id&gt;:role/athenz.zms-service&quot;</span>
<span class="err">        },</span>
<span class="err">        &quot;Action&quot;: &quot;s3:GetObject&quot;,</span>
<span class="err">        &quot;Resource&quot;: &quot;arn:aws:s3:::&lt;bucket-name&gt;/*&quot;</span>
<span class="err">    }</span>
<span class="err">    ]</span>
<span class="err">}</span>
</code></pre></div>


<p>Also enable <code>Default Encryption</code> for your bucket.</p>
<p><em>NOTE - athenz.zms-service is the EC2 role created using IAM template above</em></p>
<h3 id="generate-and-upload-service-private-key-and-id">Generate and Upload Service Private Key and Id</h3>
<p>Generate a unique private key that ZMS Server will use to sign any X509 certificates it issues:</p>
<div class="codehilite"><pre><span></span><code><span class="err">openssl genrsa -out service_private_key 2048</span>
<span class="err">openssl rsa -in service_private_key -pubout &gt; zms_service_x509_key_public</span>
</code></pre></div>


<p>Upload the service private key with name <code>service_private_key</code> onto the s3 bucket.</p>
<p>Upload the service private key id with name <code>service_private_key_id</code> onto the s3 bucket. This file just contains
the id of private key. It is not mandatory as the id defaults to <code>0</code> if not specified.</p>
<h3 id="upload-server-x509-cert-and-key">Upload Server X.509 Cert and Key</h3>
<p><em>NOTE - While it is still possible to generate and use a self-signed X509 certificate for ZMS Server, it is recommended to purchase one for your production server from a well known certificate authority. Having such a certificate installed on your ZMS Servers will no longer require to distribute the server's CA certificate to other hosts (e.g. ZTS Servers, Hosts running ZPU).</em></p>
<ul>
<li>
<p>Follow the instructions provided by the Certificate Authority that you're going to purchase your certificate from to generate your private key and Certificate Request (CSR). Submit your CSR to your CA to generate a x.509 certificate for your ZMS server.</p>
</li>
<li>
<p>If you are using self signed certs then run the following commands:</p>
</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">openssl genrsa -des3 -out zms_ca_key 4096 (Create ZMS CA Key)</span>
<span class="err">openssl req -x509 -new -nodes -key zms_ca_key -sha256 -days 1024 -out service_x509_ca_certs  (Generate CA Cert)</span>
<span class="err">openssl genrsa -out service_x509_key 2048  (Generate your private key)</span>
<span class="err">openssl req -new -key service_x509_key -out service_x509_csr  (Generate your CSR)</span>
<span class="err">openssl x509 -req -in service_x509_csr -CA service_x509_ca_certs -CAkey zms_ca_key -CAcreateserial -out service_x509_cert -days 730 -sha256  (Generate your Certificate)</span>
</code></pre></div>


<ul>
<li>Verify your certs</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">openssl x509 -in service_x509_ca_certs -text -noout</span>
<span class="err">openssl x509 -in service_x509_cert -text -noout</span>
</code></pre></div>


<p>Once you have received your X509 certificate and key:
    - Upload the certificate to s3 bucket with name <code>service_x509_cert</code>
    - Upload the private key with name <code>service_x509_key</code>
    - Upload the Root CA cert with name <code>service_x509_ca_certs</code></p>
<h3 id="upload-rds-ca-certs">Upload RDS CA Certs</h3>
<p>RDS Certs are needed if you have set <code>athenz.zms.jdbc_use_ssl=</code> property in <code>zms.properties</code> to <code>true</code>. By default it is set to <code>false</code></p>
<ul>
<li>Upload the RDS CA Certs with a filename <code>service_rds_ca_certs</code>.</li>
</ul>
<p>For details on AWS RDS Certs, Please refer to <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.SSL.html">RDS SSL Certificates in AWS</a></p>
<h3 id="upload-truststore-password">Upload truststore password</h3>
<ul>
<li>Upload password you want to use for truststore with a filename <code>service_x509_store_pwd</code></li>
</ul>
<h3 id="upload-zms-db-user-password">Upload ZMS DB User Password</h3>
<ul>
<li>Create a file containing only the password for ZMS Database user(<code>athenz-zms</code>) created above during RDS schema setup</li>
<li>Upload the file to bucket with name <code>db_user_data</code></li>
</ul>
<h2 id="create-s3-bucket-for-audit-logs">Create S3 Bucket for Audit Logs</h2>
<p>Create another bucket for audit logs having the following bucket policy:</p>
<div class="codehilite"><pre><span></span><code><span class="err">{</span>
<span class="err">&quot;Version&quot;: &quot;2012-10-17&quot;,</span>
<span class="err">&quot;Statement&quot;: [</span>
<span class="err">    {</span>
<span class="err">        &quot;Sid&quot;: &quot;&quot;,</span>
<span class="err">        &quot;Effect&quot;: &quot;Allow&quot;,</span>
<span class="err">        &quot;Principal&quot;: {</span>
<span class="err">            &quot;AWS&quot;: [</span>
<span class="err">                &quot;arn:aws:iam::&lt;account-id&gt;:role/athenz.zms-service&quot;</span>
<span class="err">            ]</span>
<span class="err">        },</span>
<span class="err">        &quot;Action&quot;: [</span>
<span class="err">            &quot;s3:AbortMultipartUpload&quot;,</span>
<span class="err">            &quot;s3:GetBucketLocation&quot;,</span>
<span class="err">            &quot;s3:GetObject&quot;,</span>
<span class="err">            &quot;s3:ListBucket&quot;,</span>
<span class="err">            &quot;s3:ListBucketMultipartUploads&quot;,</span>
<span class="err">            &quot;s3:PutObject&quot;</span>
<span class="err">        ],</span>
<span class="err">        &quot;Resource&quot;: [</span>
<span class="err">            &quot;arn:aws:s3:::&lt;audit_log_bucket_name&gt;&quot;,</span>
<span class="err">            &quot;arn:aws:s3:::&lt;audit_log_bucket_name&gt;/*&quot;</span>
<span class="err">        ]</span>
<span class="err">    }</span>
<span class="err">]</span>
<span class="err">}</span>
</code></pre></div>


<h2 id="configure-variables-and-properties">Configure Variables and Properties</h2>
<h3 id="edit-aws_initsh">Edit aws_init.sh</h3>
<p>Update the bucket names, domain admin and RDS Endpoint in <code>athenz/aws-setup/zms-setup/build/bin/aws_init.sh</code> by editing the below lines:</p>
<div class="codehilite"><pre><span></span><code><span class="err">export ZMS_DATA_BUCKET_NAME=&quot;&lt;The name of your zms data bucket&gt;&quot;</span>
<span class="err">export ZMS_AUDIT_LOG_BUCKET_NAME=&quot;&lt;The name of your zms audit data bucket&gt;&quot;</span>
<span class="err">export DOMAIN_ADMINS=&quot;&lt;zms-admin-name&gt;&quot;</span>
<span class="err">export RDS_MASTER=&quot;&lt;zms-rds-database-cluster-endpoint&gt;&quot;</span>
</code></pre></div>


<p>When running the server very first time, ZMS Server automatically creates the required domains and sets the running user as the system administrator. The system administrators are the only ones authorized to create top level domains in Athenz. Before running the server very first time, you can configure the set of system administrators who are authorized to create top level domains in Athenz. Set DOMAIN_ADMINS to unix user id that you want to add as Athenz system administrator. The password for this user is uploaded to ZMS Data S3 Bucket created above with name <code>admin_pass</code>.</p>
<ul>
<li>Create a file containing password for ZMS Domain Admin</li>
<li>Upload the file to bucket with name <code>admin_pass</code></li>
</ul>
<p>The other variables are for truststore &amp; keystore setup. We recommend to use the defaults but if you change then update the corresponding values in <code>athenz.properties</code> file discussed later.</p>
<h3 id="edit-zmsproperties-file">Edit zms.properties file</h3>
<p>The following properties need to be edited in <code>zms.properties</code> file located at <code>athenz/aws-setup/zms-setup/build/conf/zms.properties</code></p>
<h4 id="database-access">Database Access</h4>
<p>Modify the following settings if RDS username &amp; RDS password filename (stored on S3) are different from defaults suggested above.</p>
<div class="codehilite"><pre><span></span><code><span class="err">athenz.zms.object_store_factory_class=com.yahoo.athenz.zms.store.impl.JDBCObjectStoreFactory</span>
<span class="err">athenz.zms.jdbc_user=athenz-zms</span>
<span class="err">athenz.zms.jdbc_password=db_user_data</span>
</code></pre></div>


<h4 id="user-authentication">User Authentication</h4>
<p>For a user to authenticate himself/herself in ZMS, the server must have the appropriate authentication authority implementation configured. By default, ZMS enables the following two authorities:</p>
<ul>
<li>Unix User Authority - using pam login profile to authenticate users</li>
<li>Principal Authority - validating Principal Tokens that are issued when users authenticate using their unix login password.</li>
</ul>
<p>This is set using the following properties <code>athenz.zms.authority_classes=com.yahoo.athenz.auth.impl.PrincipalAuthority,com.yahoo.athenz.auth.impl.UserAuthority</code></p>
<p>The server also provides other authorities - e.g. Kerberos, TLS Certificate, that are not enabled by default.</p>
<p>To add your own authentication authority modify the: <code>athenz.zms.authority_classes=com.yahoo.athenz.auth.impl.PrincipalAuthority,com.yahoo.athenz.auth.impl.UserAuthority</code> line in <code>zms.properties</code> file and include comma separated list of authority implementation classes to support.</p>
<h4 id="domain-admins">Domain Admins</h4>
<p>Modify the below setting and set it to unix user you passed as domain admin in <code>aws_init_file</code> in above steps.</p>
<p><code>athenz.zms.domain_admin=user.zms-admin</code></p>
<h3 id="edit-athenzproperties-file">Edit athenz.properties file</h3>
<p>The following properties need to be edited in <code>athenz.properties</code> file located at <code>athenz/aws-setup/zms-setup/build/conf/athenz.properties</code></p>
<h4 id="truststore-and-keystore-settings">Truststore and Keystore Settings</h4>
<p>If you modified the truststore and keystore paths and password in the <code>aws_init.sh</code> file then change the below settings in <code>athenz.properties</code> file accordingly:</p>
<ul>
<li><code>athenz.ssl_key_store=/opt/zms/conf/zms_keystore.pkcs12 //path to the keystore file that contains the server's certificate</code></li>
<li><code>athenz.ssl_key_store_type=PKCS12 //specifies the type for the keystore specified in the</code></li>
<li><code>athenz.ssl_key_store_password=service_x509_store_pwd //S3 bucket  key name for Password for the keystore specified in the athenz.ssl_key_store property</code></li>
<li><code>athenz.ssl_trust_store=/opt/zms/conf/zms_truststore.jks //path to the trust store file that contains CA certificates trusted by this Jetty instance</code></li>
<li><code>athenz.ssl_trust_store_type=JKS //specifies the type for the truststore specified</code></li>
<li><code>athenz.ssl_trust_store_password=service_x509_store_pwd //password for the truststore</code></li>
</ul>
<h2 id="packer">Packer</h2>
<h3 id="packer-vpc-setup">Packer VPC Setup</h3>
<p>Setup packer vpc by using the <a href="https://github.com/yahoo/athenz/blob/master/aws-setup/cloud-formation/packer_vpc.yaml">cloudformation template</a> and update <code>packer.json</code> file accordingly.</p>
<div class="codehilite"><pre><span></span><code><span class="err">{</span>
   <span class="s2">&quot;subnet_id&quot;</span><span class="p">:</span><span class="s2">&quot;&lt;packer_public_subnet_id&gt;&quot;</span><span class="p">,</span>
   <span class="s2">&quot;vpc_id&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;vpc_id&gt;&quot;</span><span class="p">,</span>
   <span class="s2">&quot;aws_region&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;aws-region where you created the resources&gt;&quot;</span><span class="p">,</span>
   <span class="s2">&quot;aws_ami_name&quot;</span><span class="p">:</span> <span class="s2">&quot;zms-aws-cd-image&quot;</span><span class="p">,</span>
   <span class="s2">&quot;aws_access_key&quot;</span><span class="p">:</span> <span class="s2">&quot;{{env `AWS_ACCESS_KEY_ID`}}&quot;</span><span class="p">,</span>
   <span class="s2">&quot;aws_secret_key&quot;</span><span class="p">:</span> <span class="s2">&quot;{{env `AWS_SECRET_ACCESS_KEY`}}&quot;</span><span class="p">,</span>
   <span class="s2">&quot;aws_session_token&quot;</span><span class="p">:</span> <span class="s2">&quot;{{env `AWS_SESSION_TOKEN`}}&quot;</span><span class="p">,</span>
   <span class="s2">&quot;ssh_keypair_name&quot;</span><span class="p">:</span><span class="s2">&quot;&lt;EC2_SSH_Key_Name&gt;&quot;</span><span class="p">,</span>
   <span class="s2">&quot;ssh_private_key_file&quot;</span><span class="p">:</span><span class="s2">&quot;&lt;PATH_TO_SSH_KEYPAIR&gt;&quot;</span><span class="p">,</span>
   <span class="s2">&quot;source_ami&quot;</span><span class="p">:</span> <span class="s2">&quot;ami-02c71d7a&quot;</span>
<span class="err">}</span>
</code></pre></div>


<h3 id="build-zms-image">Build ZMS image</h3>
<p>Build the image with packer using the following command:</p>
<div class="codehilite"><pre><span></span><code><span class="err">cd /aws-setup/zms-setup</span>
<span class="err">packer build packer/aws/packer.json</span>
</code></pre></div>


<h2 id="deploy-zms">Deploy ZMS</h2>
<p>Run <a href="https://github.com/yahoo/athenz/blob/master/aws-setup/zms-setup/cloud-formation/athenz-zms-aws-instance-deployment.yaml">cloudformation template</a> to bring up the zms-instances in 2 availability zones.</p>
<ul>
<li>The imageID parameter should be set to the image created in previous step.</li>
</ul>
<p>The ZMS Server is now up and running.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../aws_athenz_setup/" title="Introduction" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Introduction
              </div>
            </div>
          </a>
        
        
          <a href="../aws_zts_setup/" title="ZTS Server" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                ZTS Server
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.d1f5a259.min.js"></script>
      <script src="../assets/javascripts/bundle.d5fec882.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.fae956e7.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>